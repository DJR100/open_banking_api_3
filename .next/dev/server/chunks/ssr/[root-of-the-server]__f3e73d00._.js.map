{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/dillonroberts/Documents/open_banking_api_003/lib/classify.ts"],"sourcesContent":["const gamblingRe = /(bet365|betfair|ladbrokes|william ?hill|sky ?bet|coral|paddy ?power|pokerstars|888|casino)/i;\n\nexport function isGambling(t: any) {\n  const mcc = t?.mcc ? String(t.mcc) : null;\n  const byMcc = mcc === '7995';\n  const byPfc = typeof t?.pfc === 'string' && /gambl/i.test(t.pfc);\n  const byCat = Array.isArray(t?.category) && t.category.some((c: string) => /gambl/i.test(c));\n  const byName = gamblingRe.test(String(t?.merchant_name || t?.name || ''));\n  return byMcc || byPfc || byCat || byName;\n}\n\n// Spend semantics per source: Plaid spend positive; CSV spend negative -> use abs(negatives)\nexport function spendValue(t: any): number {\n  const isCsv = t?._source === 'csv';\n  const amt = Number(t?.amount || 0);\n  if (isCsv) return amt < 0 ? Math.abs(amt) : 0;\n  return amt > 0 ? amt : 0;\n}\n\nexport function bucket(transactions: any[], granularity: 'year'|'month'|'week'|'day') {\n  const fmt = (d: Date) => {\n    const y = d.getUTCFullYear();\n    const m = String(d.getUTCMonth() + 1).padStart(2, '0');\n    const dd = String(d.getUTCDate()).padStart(2, '0');\n    if (granularity === 'year') return `${y}`;\n    if (granularity === 'month') return `${y}-${m}`;\n    if (granularity === 'week') {\n      const tmp = new Date(Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate()));\n      const day = (d.getUTCDay() + 6) % 7; // Monday=0\n      tmp.setUTCDate(d.getUTCDate() - day);\n      const wm = String(tmp.getUTCMonth() + 1).padStart(2, '0');\n      const wd = String(tmp.getUTCDate()).padStart(2, '0');\n      return `${tmp.getUTCFullYear()}-W${wm}-${wd}`;\n    }\n    return `${y}-${m}-${dd}`;\n  };\n\n  const out: Record<string, number> = {};\n  for (const t of transactions) {\n    if (!isGambling(t)) continue;\n    const dateStr = t?.date || (t?.datetime ? String(t.datetime).slice(0, 10) : null);\n    if (!dateStr) continue;\n    const date = new Date(`${dateStr}T00:00:00Z`);\n    const key = fmt(date);\n    const spend = spendValue(t);\n    out[key] = (out[key] || 0) + spend;\n  }\n  return out;\n}\n\nexport function totalSpend(transactions: any[]) {\n  return transactions.reduce((acc, t) => acc + (isGambling(t) ? spendValue(t) : 0), 0);\n}\n\nexport function topMerchants(transactions: any[], windowDays = 90) {\n  const now = new Date();\n  const cutoff = new Date(now);\n  cutoff.setUTCDate(now.getUTCDate() - windowDays);\n  const sums: Record<string, number> = {};\n  for (const t of transactions) {\n    if (!isGambling(t)) continue;\n    const dateStr = t?.date || (t?.datetime ? String(t.datetime).slice(0, 10) : null);\n    if (!dateStr) continue;\n    const dt = new Date(`${dateStr}T00:00:00Z`);\n    if (dt < cutoff) continue;\n    const merchant = String(t?.merchant_name || t?.name || 'Unknown');\n    sums[merchant] = (sums[merchant] || 0) + spendValue(t);\n  }\n  return Object.entries(sums)\n    .map(([merchant, amount]) => ({ merchant, amount }))\n    .sort((a, b) => b.amount - a.amount);\n}\n\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///Users/dillonroberts/Documents/open_banking_api_003/app/dashboard/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useMemo, useState } from 'react';\nimport { Bar } from 'react-chartjs-2';\nimport 'chart.js/auto';\nimport { bucket, topMerchants, totalSpend } from '@/lib/classify';\n\ntype Period = 'year' | 'month' | 'week' | 'day';\nconst gbp = new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP' });\n\nexport default function Dashboard() {\n  const [txns, setTxns] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [period, setPeriod] = useState<Period>('month');\n\n  useEffect(() => {\n    setLoading(true);\n    fetch('/api/transactions')\n      .then(r => r.json())\n      .then(d => setTxns(d.transactions || []))\n      .finally(() => setLoading(false));\n  }, []);\n\n  const totals = useMemo(() => bucket(txns, period), [txns, period]);\n  const labels = useMemo(() => Object.keys(totals).sort(), [totals]);\n  const dataVals = useMemo(() => labels.map(k => totals[k] || 0), [labels, totals]);\n  const totalValue = useMemo(() => totalSpend(txns), [txns]);\n  const merchantRows = useMemo(() => topMerchants(txns, 90).slice(0, 10), [txns]);\n\n  const hasAnyGamblingThisView = dataVals.some(v => v > 0);\n\n  return (\n    <main className=\"p-8 max-w-4xl mx-auto\">\n      <h1 className=\"text-2xl font-semibold mb-4\">Gambling Spend</h1>\n\n      <div className=\"mb-4\">\n        <select\n          value={period}\n          onChange={e => setPeriod(e.target.value as Period)}\n          className=\"border px-2 py-1 rounded\"\n        >\n          <option value=\"year\">Year</option>\n          <option value=\"month\">Month</option>\n          <option value=\"week\">Week</option>\n          <option value=\"day\">Day</option>\n        </select>\n      </div>\n\n      <div className=\"text-lg font-medium mb-4\">Total: {gbp.format(totalValue)}</div>\n\n      {loading ? (\n        <div className=\"text-gray-500\">Loadingâ€¦</div>\n      ) : txns.length === 0 ? (\n        <div className=\"text-gray-600 border rounded p-4\">\n          No transactions loaded. Go back and connect or upload a CSV.\n        </div>\n      ) : !hasAnyGamblingThisView ? (\n        <div className=\"text-gray-600 border rounded p-4\">\n          No gambling transactions detected for this period.\n        </div>\n      ) : (\n        <div className=\"mb-8\">\n          <Bar\n            data={{\n              labels,\n              datasets: [\n                {\n                  label: 'Gambling Spend',\n                  data: dataVals,\n                  backgroundColor: 'rgba(0, 0, 0, 0.7)',\n                },\n              ],\n            }}\n            options={{\n              animation: false,\n              responsive: true,\n              scales: {\n                y: { beginAtZero: true, ticks: { callback: (v) => gbp.format(Number(v)) } },\n              },\n            }}\n          />\n        </div>\n      )}\n\n      <section>\n        <h2 className=\"text-lg font-semibold mb-2\">Top gambling merchants (90 days)</h2>\n        {merchantRows.length === 0 ? (\n          <div className=\"text-gray-600 border rounded p-4\">\n            No gambling transactions in the last 90 days.\n          </div>\n        ) : (\n          <div className=\"border rounded overflow-hidden\">\n            <table className=\"w-full text-sm\">\n              <thead className=\"bg-gray-50\">\n                <tr>\n                  <th className=\"text-left px-3 py-2\">Merchant</th>\n                  <th className=\"text-right px-3 py-2\">Spend</th>\n                </tr>\n              </thead>\n              <tbody>\n                {merchantRows.map(row => (\n                  <tr key={row.merchant} className=\"border-t\">\n                    <td className=\"px-3 py-2\">{row.merchant}</td>\n                    <td className=\"px-3 py-2 text-right\">{gbp.format(row.amount)}</td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        )}\n      </section>\n    </main>\n  );\n}\n\n\n"],"names":[],"mappings":"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","debugId":null}}]
}