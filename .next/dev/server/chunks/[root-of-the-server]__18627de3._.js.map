{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/dillonroberts/Documents/open_banking_api_003/lib/plaid.ts"],"sourcesContent":["import { Configuration, PlaidApi, PlaidEnvironments } from 'plaid';\n\nexport const plaid = new PlaidApi(new Configuration({\n  basePath: PlaidEnvironments.sandbox,\n  baseOptions: {\n    headers: {\n      'PLAID-CLIENT-ID': process.env.PLAID_CLIENT_ID!,\n      'PLAID-SECRET': process.env.PLAID_SANDBOX_SECRET!,\n    },\n  },\n}));\n\n\n\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,QAAQ,IAAI,+GAAQ,CAAC,IAAI,oHAAa,CAAC;IAClD,UAAU,wHAAiB,CAAC,OAAO;IACnC,aAAa;QACX,SAAS;YACP,mBAAmB,QAAQ,GAAG,CAAC,eAAe;YAC9C,gBAAgB,QAAQ,GAAG,CAAC,oBAAoB;QAClD;IACF;AACF","debugId":null}},
    {"offset": {"line": 41, "column": 0}, "map": {"version":3,"sources":["file:///Users/dillonroberts/Documents/open_banking_api_003/lib/store.ts"],"sourcesContent":["// Simple in-memory store. Single-process only (hackathon demo).\nlet ACCESS_TOKEN: string | null = null;\nlet OVERRIDE_TXNS: any[] | null = null;\n\nexport function setAccessToken(token: string) {\n  ACCESS_TOKEN = token;\n  // Reset CSV override when linking a bank\n  OVERRIDE_TXNS = null;\n}\nexport function getAccessToken() {\n  return ACCESS_TOKEN;\n}\n\nexport function setOverrideTransactions(txns: any[]) {\n  OVERRIDE_TXNS = txns;\n}\nexport function getOverrideTransactions() {\n  return OVERRIDE_TXNS;\n}\n\n\n"],"names":[],"mappings":"AAAA,gEAAgE;;;;;;;;;;;AAChE,IAAI,eAA8B;AAClC,IAAI,gBAA8B;AAE3B,SAAS,eAAe,KAAa;IAC1C,eAAe;IACf,yCAAyC;IACzC,gBAAgB;AAClB;AACO,SAAS;IACd,OAAO;AACT;AAEO,SAAS,wBAAwB,IAAW;IACjD,gBAAgB;AAClB;AACO,SAAS;IACd,OAAO;AACT","debugId":null}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///Users/dillonroberts/Documents/open_banking_api_003/lib/kv.ts"],"sourcesContent":["import { Redis } from '@upstash/redis';\n\n// Best-effort Redis client. If env vars are missing locally, kv will be null.\nlet kvInstance: Redis | null = null;\ntry {\n  kvInstance = Redis.fromEnv();\n} catch {\n  kvInstance = null;\n}\n\nexport const kv = kvInstance;\n\n\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,8EAA8E;AAC9E,IAAI,aAA2B;AAC/B,IAAI;IACF,aAAa,6IAAK,CAAC,OAAO;AAC5B,EAAE,OAAM;IACN,aAAa;AACf;AAEO,MAAM,KAAK","debugId":null}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///Users/dillonroberts/Documents/open_banking_api_003/pages/api/transactions.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\nimport { plaid } from '@/lib/plaid';\nimport { getAccessToken, getOverrideTransactions } from '@/lib/store';\nimport { kv } from '@/lib/kv';\nimport * as cookie from 'cookie';\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  try {\n    // 1) Prefer KV (serverless-safe) if session cookie present\n    const cookies = cookie.parse(req.headers.cookie || '');\n    const sess = cookies['demo_session'];\n    if (kv && sess) {\n      try {\n        const kvTxns = await kv.get<any[]>(`csv:${sess}`);\n        if (Array.isArray(kvTxns) && kvTxns.length) {\n          return res.status(200).json({ transactions: kvTxns });\n        }\n      } catch {}\n    }\n\n    // 2) Fallback to in-memory override (works locally)\n    const csvOverride = getOverrideTransactions();\n    if (csvOverride && csvOverride.length) {\n      return res.status(200).json({ transactions: csvOverride });\n    }\n\n    // Try to load Plaid access token from KV using session cookie\n    let access_token = getAccessToken(); // local dev fallback\n    if (kv && !access_token && sess) {\n      try {\n        const tk = await kv.get<string>(`plaid_access:${sess}`);\n        if (tk) access_token = tk;\n      } catch {}\n    }\n    if (!access_token) return res.status(200).json({ transactions: [] });\n\n    const sync = await plaid.transactionsSync({ access_token, count: 500 });\n    const txns = (sync.data.added || []).map((t: any) => ({\n      id: t.transaction_id,\n      date: t.date,\n      datetime: (t as any).datetime || t.authorized_datetime || null,\n      amount: t.amount, // Plaid: spend positive\n      merchant_name: t.merchant_name || t.name,\n      mcc: t.merchant_category_code || null,\n      category: t.category || [],\n      pfc: t.personal_finance_category?.detailed || null,\n      currency: t.iso_currency_code || t.unofficial_currency_code || 'GBP',\n      _source: 'plaid',\n    }));\n    res.status(200).json({ transactions: txns });\n  } catch (e: any) {\n    res.status(500).json({ error: e.message });\n  }\n}\n\n\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;;;;;;;;;AAEe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,IAAI;QACF,2DAA2D;QAC3D,MAAM,UAAU,8GAAY,CAAC,IAAI,OAAO,CAAC,MAAM,IAAI;QACnD,MAAM,OAAO,OAAO,CAAC,eAAe;QACpC,IAAI,wGAAE,IAAI,MAAM;YACd,IAAI;gBACF,MAAM,SAAS,MAAM,wGAAE,CAAC,GAAG,CAAQ,CAAC,IAAI,EAAE,MAAM;gBAChD,IAAI,MAAM,OAAO,CAAC,WAAW,OAAO,MAAM,EAAE;oBAC1C,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;wBAAE,cAAc;oBAAO;gBACrD;YACF,EAAE,OAAM,CAAC;QACX;QAEA,oDAAoD;QACpD,MAAM,cAAc,IAAA,gIAAuB;QAC3C,IAAI,eAAe,YAAY,MAAM,EAAE;YACrC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,cAAc;YAAY;QAC1D;QAEA,8DAA8D;QAC9D,IAAI,eAAe,IAAA,uHAAc,KAAI,qBAAqB;QAC1D,IAAI,wGAAE,IAAI,CAAC,gBAAgB,MAAM;YAC/B,IAAI;gBACF,MAAM,KAAK,MAAM,wGAAE,CAAC,GAAG,CAAS,CAAC,aAAa,EAAE,MAAM;gBACtD,IAAI,IAAI,eAAe;YACzB,EAAE,OAAM,CAAC;QACX;QACA,IAAI,CAAC,cAAc,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,cAAc,EAAE;QAAC;QAElE,MAAM,OAAO,MAAM,8GAAK,CAAC,gBAAgB,CAAC;YAAE;YAAc,OAAO;QAAI;QACrE,MAAM,OAAO,CAAC,KAAK,IAAI,CAAC,KAAK,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC,IAAW,CAAC;gBACpD,IAAI,EAAE,cAAc;gBACpB,MAAM,EAAE,IAAI;gBACZ,UAAU,AAAC,EAAU,QAAQ,IAAI,EAAE,mBAAmB,IAAI;gBAC1D,QAAQ,EAAE,MAAM;gBAChB,eAAe,EAAE,aAAa,IAAI,EAAE,IAAI;gBACxC,KAAK,EAAE,sBAAsB,IAAI;gBACjC,UAAU,EAAE,QAAQ,IAAI,EAAE;gBAC1B,KAAK,EAAE,yBAAyB,EAAE,YAAY;gBAC9C,UAAU,EAAE,iBAAiB,IAAI,EAAE,wBAAwB,IAAI;gBAC/D,SAAS;YACX,CAAC;QACD,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,cAAc;QAAK;IAC5C,EAAE,OAAO,GAAQ;QACf,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,EAAE,OAAO;QAAC;IAC1C;AACF","debugId":null}}]
}